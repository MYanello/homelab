# Bootstrap argocd to k8s cluster
---
- name: Install argocd to k8s cluster
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create namespace
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: argocd
    - name: Install argocd
      kubernetes.core.k8s:
        state: present
        src: https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
        namespace: argocd

    # - name: Patch argocd-server service to use LoadBalancer
    #   kubernetes.core.k8s:
    #     state: present
    #     definition:
    #       apiVersion: v1
    #       kind: Service
    #       metadata:
    #         name: argocd-server
    #         namespace: argocd
    #       spec:
    #         type: LoadBalancer
    #         ports:
    #           - port: 80
    #             targetPort: 8080
    #             protocol: TCP
    #             name: http
    #           - port: 443
    #             targetPort: 8080
    #             protocol: TCP
    #             name: https