kubeProxyReplacement: true

ingressController:
  enabled: false
  loadBalancerMode: shared
  default: true
  service:
    annotations:
      io.cilium/lb-ipam-ips: 10.20.8.0/22

rollOutCiliumPods: true

ipam:
  operator:
    clusterPoolIPv4PodCIDRList: 10.244.0.0/16

k8sServiceHost: 192.168.10.200
k8sServicePort: 6443
devices: end0
gatewayAPI:
  enabled: true
  enableAlpn: true
  enableAppProtocol: true
  xffNumTrustedHops: 2

# for preserving source ips
loadBalancer:
  mode: dsr
  dsrDispatch: opt
routingMode: native
enableIPv4Masquerade: true
ipv4NativeRoutingCIDR: 10.0.0.0/8
autoDirectNodeRoutes: true

envoy:
  securityContext:
    capabilities:
      keepCapNetBindService: true

hubble:
  enabled: false
  ui:
    enabled: false
  relay:
    enabled: false

bgpControlPlane:
  enabled: true

securityContext:
  capabilities:
    ciliumAgent:
      - CHOWN
      - KILL
      - NET_ADMIN
      - NET_RAW
      - IPC_LOCK
      - SYS_ADMIN
      - SYS_RESOURCE
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID
    cleanCiliumState:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE

cgroup:
  autoMount:
    enabled: false
    hostRoot: /sys/fs/cgroup

cluster:
  name: talos
  id: 2
clustermesh:
  useAPIServer: true
  apiserver:
    tolerations:
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Exists"
        effect: "NoSchedule"
    service:
      type: LoadBalancer
      loadBalancerIP: 10.20.8.102
  config:
    enabled: true
    clusters:
      - name: home
        port: 2379
        ips:
          - 192.168.10.100
      - name: talos
        port: 2379
        ips:
          - 192.168.10.200
