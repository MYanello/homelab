apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: plex
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    name: in-cluster
    namespace: plex
  syncPolicy:
    automated:
      prune: true
      selfHeal: false
    syncOptions:
      - CreateNamespace=true
  project: default
  source:
    repoURL: https://raw.githubusercontent.com/plexinc/pms-docker/gh-pages
    targetRevision: "0.8.0"
    chart: plex-media-server
    helm:
      valuesObject:
        ingress:
          enabled: true
          url: plex.k8s.yanello.net
        pms:
          storageClassName: nfs-storage
          configStorage: 100Gi
          gpu:
            nvidia:
              enabled: false
        readinessProbe:
          httpGet:
            path: /identity
            port: 32400
          initialDelaySeconds: 180
          periodSeconds: 60
          timeoutSeconds: 1
          failureThreshold: 3
        livenessProbe:
          httpGet:
            path: /identity
            port: 32400
          initialDelaySeconds: 60
          periodSeconds: 60
          timeoutSeconds: 1
          failureThreshold: 3
        service:
          type: LoadBalancer
          annotations:
            metallb.universe.tf/loadBalancerIPs: 10.10.8.10