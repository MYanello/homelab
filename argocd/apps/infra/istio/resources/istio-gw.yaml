apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: kube-gateway
spec:
  selector:
    istio: ingressgateway
  servers:
    - hosts:
        - "*.yanello.net"
        - yanello.net
      port:
        name: http
        number: 80
        protocol: HTTP
      # tls:
      #   httpsRedirect: true
    - hosts:
        - "*.yanello.net"
        - "yanello.net"
      port:
        number: 443
        name: https
        protocol: HTTPS
      tls:
        credentialName: default-ingress-cert
        # maxProtocolVersion: TLSV1_3
        # minProtocolVersion: TLSV1_2
        mode: SIMPLE
        cipherSuites:
          - AES_256_GCM_SHA384
          - ECDHE-ECDSA-CHACHA20-POLY1305
          - ECDHE-ECDSA-AES256-GCM-SHA384
          - ECDHE-RSA-AES256-GCM-SHA384
          - ECDHE-ECDSA-CHACHA20-POLY1305
          - ECDHE-RSA-CHACHA20-POLY1305
---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: gateway-api
spec:
  addresses:
      # - type: Hostname
      #   value: gateway-api-svc.istio-system.svc.cluster.local
      - value: 10.10.8.1
        type: IPAddress
  gatewayClassName: istio
  listeners:
    - name: http
      protocol: HTTP
      hostname: "*.yanello.net"
      port: 80
      allowedRoutes:
        namespaces:
          from: All
        kinds:
          - kind: HTTPRoute
    - name: https
      protocol: HTTPS
      hostname: "*.yanello.net"
      port: 443
      tls:
        mode: Terminate
        certificateRefs:
          - name: default-ingress-cert
      allowedRoutes:
        namespaces:
          from: All
        kinds:
          - kind: HTTPRoute
---
# apiVersion: v1
# kind: Service
# metadata:
#   annotations:
#     metallb.io/ip-allocated-from-pool: address-pool
#   labels:
#     app.kubernetes.io/instance: istio-resources
#     gateway.istio.io/managed: istio.io-gateway-controller
#     gateway.networking.k8s.io/gateway-name: gateway-api
#   name: gateway-api-istio-svc
#   namespace: istio-system
#   ownerReferences:
#     - apiVersion: gateway.networking.k8s.io/v1beta1
#       kind: Gateway
#       name: gateway-api
# spec:
#   externalTrafficPolicy: Local
#   healthCheckNodePort: 31089
#   internalTrafficPolicy: Cluster
#   ipFamilies:
#     - IPv4
#   ipFamilyPolicy: PreferDualStack
#   loadBalancerIP: 10.10.8.1
#   ports:
#     - appProtocol: tcp
#       name: status-port
#       nodePort: 30696
#       port: 15021
#       protocol: TCP
#       targetPort: 15021
#     - appProtocol: http
#       name: http
#       nodePort: 30853
#       port: 80
#       protocol: TCP
#       targetPort: 80
#     - appProtocol: https
#       name: https
#       nodePort: 31707
#       port: 443
#       protocol: TCP
#       targetPort: 443
#   selector:
#     gateway.networking.k8s.io/gateway-name: gateway-api
#   type: LoadBalancer
# status:
#   loadBalancer:
#     ingress:
#       - ip: 10.10.8.1
#         ipMode: VIP
# ---
# apiVersion: gateway.networking.k8s.io/v1
# kind: Gateway
# metadata:
#   name: tls-passthrough-gateway
# spec:
#   addresses:
#     - value: 10.10.8.1
#       type: IPAddress
#   gatewayClassName: istio
#   listeners:
#     - name: gateway-tls-passthrough
#       protocol: TLS
#       port: 443
#       hostname: "*.yanello.net"
#       tls:
#         mode: Passthrough
#       allowedRoutes:
#         namespaces:
#           from: All
