apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-domain-access-policy
  namespace: istio-system
spec:
  action: ALLOW
  rules:
    # Allow all traffic from internal network (LAN)
    - from:
        - source:
            remoteIpBlocks:
              - "10.0.0.0/8"
              - "172.16.0.0/12"
              - "192.168.0.0/16"
    # Allow WAN traffic only to specific subdomains
    - from:
        - source:
            notRemoteIpBlocks:
              - "10.0.0.0/8"
              - "172.16.0.0/12"
              - "192.168.0.0/16"
      to:
        - operation:
            hosts:
              - plex.yanello.net
              - argocd.yanello.net
              - renovate.yanello.net
              - ombi.yanello.net
              - ytdl.yanello.net
              - nextcloud.yanello.net
              - homeassistant.yanello.net
              - overseerr.yanello.net
              - immich.yanello.net
              - bitwarden.yanello.net
# ---
# apiVersion: security.istio.io/v1
# kind: AuthorizationPolicy
# metadata:
#   name: allow-nothing
# spec:
#   action: DENY
#   rules: 
#     - {}