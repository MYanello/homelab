apiVersion: opentelemetry.io/v1beta1
kind: OpenTelemetryCollector
metadata:
  name: collector
spec:
  mode: daemonset
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  hostNetwork: false
  config:
    processors:
      deltatocumulative:
        max_stale: 5m
    receivers:
      otlp:
        protocols: 
          grpc:
            endpoint: ":4317"
          http:
            endpoint: ":4318"
    exporters:
      otlphttp/victoriametrics:
        encoding: proto
        compression: gzip
        metrics_endpoint: vmsingle-victoria-metrics-k8s-stack:8429/opentelemetry/v1/metrics
        logs_endpoint: http://victoria-logs-single-server.monitoring.svc.cluster.local:9428/insert/opentelemetry/v1/logs
      debug:
        verbosity: detailed
    service:
      pipelines:
        logs:
          receivers: [otlp]
          processors: []
          exporters: [otlphttp/victoriametrics]
        metrics:
          receivers: [otlp]
          processors: [deltatocumulative]
          exporters: [otlphttp/victoriametrics]