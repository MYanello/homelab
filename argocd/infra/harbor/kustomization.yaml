apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generators:
  - ./secret-generator.yaml

helmCharts:
  - name: harbor
    namespace: harbor
    releaseName: harbor
    repo: https://helm.goharbor.io
    version: "1.18.0"
    valuesInline:
      existingSecretAdminPassword: harbor-secrets
      expose:
        type: route
        tls:
          enabled: false
        route:
          parentRefs:
            - name: cilium-private-gateway
              namespace: cilium
              sectionName: https
          hosts:
            - harbor.yanello.net
      externalURL: harbor.yanello.net
      persistence:
        persistentVolumeClaim:
          registry:
            storageClass: truenas-hdd
          chartmuseum:
            storageClass: truenas-hdd
          jobservice:
            jobLog:
              storageClass: truenas-hdd
          database:
            storageClass: truenas-ssd
          redis:
            storageClass: truenas-ssd
          trivy:
            storageClass: truenas-hdd
      cache:
        enabled: true