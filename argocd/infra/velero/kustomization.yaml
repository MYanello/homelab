apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generators:
  - ./secret-generator.yaml

helmCharts:
  - name: velero
    releaseName: velero
    namespace: velero
    repo: https://vmware-tanzu.github.io/helm-charts
    version: 11.0.0
    valuesInline:
      initContainers:
        - name: velero-plugin-for-aws
          image: velero/velero-plugin-for-aws:v1.13.0
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - mountPath: /target
              name: plugins
      credentials:
        useSecret: true
        existingSecret: cloud-credentials
      configuration:
        backupStorageLocation:
          - name: backblaze
            provider: aws
            bucket: myanello-velero
            default: true
            credential:
              name: cloud-credentials
              key: cloud
            config:
              region: us-west-004
              s3Url: https://s3.us-west-004.backblazeb2.com
        volumeSnapshotLocation:
          - name: backblaze
            provider: aws
            bucket: myanello-velero
            default: true
            credential:
              name: cloud-credentials
              key: cloud
            config:
              region: us-west-004
              s3Url: https://s3.us-west-004.backblazeb2.com
